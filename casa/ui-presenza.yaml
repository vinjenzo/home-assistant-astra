type: vertical-stack
cards:
  # ============================================================
  # INTESTAZIONE
  # ============================================================
  - type: markdown
    content: |
      ## ðŸ“ Presenza e Posizione
      Gestione presenza in casa e automazioni
    card_mod:
      style: |
        ha-card {
          background: rgba(255,255,255,0.05);
          border-radius: 12px;
          padding: 8px;
        }

  # ============================================================
  # STANZA ATTUALE
  # ============================================================
  - type: custom:button-card
    entity: input_select.stanza_attuale
    name: Stanza Attuale
    show_state: true
    icon: mdi:home-search
    tap_action:
      action: more-info
    styles:
      card:
        - background: |
            [[[
              const stanza = states['input_select.stanza_attuale'].state;
              if (stanza === 'Indeterminato') return 'rgba(158,158,158,0.08)';
              return 'rgba(33,150,243,0.08)';
            ]]]
        - border-radius: 12px
        - border: 1px solid rgba(33,150,243,0.2)
        - padding: 16px
      icon:
        - width: 50px
        - color: |
            [[[
              const stanza = states['input_select.stanza_attuale'].state;
              const icons = {
                'Soggiorno': '#42a5f5',
                'Camera': '#7e57c2',
                'Camera da Letto': '#ec407a',
                'Cucina': '#ff9800'
              };
              return icons[stanza] || '#9e9e9e';
            ]]]
      name:
        - color: white
        - font-size: 16px
        - font-weight: bold
      state:
        - color: white
        - font-size: 24px
        - font-weight: bold
        - margin-top: 8px

  # ============================================================
  # AUTOMAZIONI LUCI
  # ============================================================
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        styles:
          card:
            - width: 12px
            - background: transparent
            - border: none
            - box-shadow: none
            - padding: 0
            - cursor: default
        tap_action:
          action: none
      - type: custom:button-card
        entity: input_boolean.automazioni_luci
        name: Automazioni Luci BLE
        icon: mdi:lightbulb-auto
        show_state: false
        tap_action:
          action: toggle
        styles:
          card:
            - background: |
                [[[
                  return entity.state === 'on' 
                    ? 'rgba(76,175,80,0.08)' 
                    : 'rgba(158,158,158,0.08)';
                ]]]
            - border-radius: 12px
            - border: |
                [[[
                  return entity.state === 'on' 
                    ? '1px solid rgba(76,175,80,0.3)' 
                    : '1px solid rgba(158,158,158,0.2)';
                ]]]
            - padding: 16px
          icon:
            - width: 45px
            - color: |
                [[[
                  return entity.state === 'on' ? '#4caf50' : '#9e9e9e';
                ]]]
          name:
            - color: white
            - font-size: 14px
            - font-weight: bold
      - type: custom:button-card
        styles:
          card:
            - width: 12px
            - background: transparent
            - border: none
            - box-shadow: none
            - padding: 0
            - cursor: default
        tap_action:
          action: none

  # ============================================================
  # SEGNALE BLE (se disponibile)
  # ============================================================
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        styles:
          card:
            - width: 12px
            - background: transparent
            - border: none
            - box-shadow: none
            - padding: 0
            - cursor: default
        tap_action:
          action: none
      - type: custom:button-card
        entity: sensor.moto_g42_rssi
        name: Segnale BLE (Moto G42)
        icon: mdi:bluetooth-audio
        show_state: true
        state_display: "[[[ return `${entity.state} dBm` ]]]"
        tap_action:
          action: more-info
        styles:
          card:
            - background: rgba(33,150,243,0.08)
            - border-radius: 12px
            - border: 1px solid rgba(33,150,243,0.2)
          icon:
            - width: 40px
            - color: |
                [[[
                  const rssi = parseFloat(entity?.state);
                  if (rssi > -60) return '#4caf50';
                  if (rssi > -80) return '#ff9800';
                  return '#f44336';
                ]]]
          name:
            - color: white
            - font-size: 13px
          state:
            - color: white
            - font-weight: bold
            - font-size: 16px

      - type: custom:button-card
        entity: sensor.moto_g42_distanza
        name: Distanza (Moto G42)
        icon: mdi:map-marker-distance
        show_state: true
        state_display: "[[[ return `${entity.state} m` ]]]"
        tap_action:
          action: more-info
        styles:
          card:
            - background: rgba(103,58,183,0.08)
            - border-radius: 12px
            - border: 1px solid rgba(103,58,183,0.2)
          icon:
            - width: 40px
            - color: "#9575cd"
          name:
            - color: white
            - font-size: 13px
          state:
            - color: white
            - font-weight: bold
            - font-size: 16px
      - type: custom:button-card
        styles:
          card:
            - width: 12px
            - background: transparent
            - border: none
            - box-shadow: none
            - padding: 0
            - cursor: default
        tap_action:
          action: none

  # ============================================================
  # SEGNALE BLE PIXEL 9A
  # ============================================================
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        styles:
          card:
            - width: 12px
            - background: transparent
            - border: none
            - box-shadow: none
            - padding: 0
            - cursor: default
        tap_action:
          action: none
      - type: custom:button-card
        entity: sensor.pixel_9a_rssi
        name: Segnale BLE (Pixel 9a)
        icon: mdi:bluetooth-audio
        show_state: true
        state_display: "[[[ return `${entity.state} dBm` ]]]"
        tap_action:
          action: more-info
        styles:
          card:
            - background: rgba(33,150,243,0.08)
            - border-radius: 12px
            - border: 1px solid rgba(33,150,243,0.2)
          icon:
            - width: 40px
            - color: |
                [[[
                  const rssi = parseFloat(entity?.state);
                  if (rssi > -60) return '#4caf50';
                  if (rssi > -80) return '#ff9800';
                  return '#f44336';
                ]]]
          name:
            - color: white
            - font-size: 13px
          state:
            - color: white
            - font-weight: bold
            - font-size: 16px

      - type: custom:button-card
        entity: sensor.pixel_9a_distanza
        name: Distanza (Pixel 9a)
        icon: mdi:map-marker-distance
        show_state: true
        state_display: "[[[ return `${entity.state} m` ]]]"
        tap_action:
          action: more-info
        styles:
          card:
            - background: rgba(103,58,183,0.08)
            - border-radius: 12px
            - border: 1px solid rgba(103,58,183,0.2)
          icon:
            - width: 40px
            - color: "#9575cd"
          name:
            - color: white
            - font-size: 13px
          state:
            - color: white
            - font-weight: bold
            - font-size: 16px
      - type: custom:button-card
        styles:
          card:
            - width: 12px
            - background: transparent
            - border: none
            - box-shadow: none
            - padding: 0
            - cursor: default
        tap_action:
          action: none
