type: vertical-stack
cards:
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        styles:
          card:
            - width: 12px
            - background: transparent
            - border: none
            - box-shadow: none
            - padding: 0
            - cursor: default
        tap_action:
          action: none
      - type: custom:button-card
        entity: binary_sensor.zona_led_camera_accesa
        name: Camera
        icon: mdi:led-strip-variant
        tap_action:
          action: call-service
          service: |
            [[[
              if (states['input_boolean.led_bulk_mode']?.state === 'on') return null;
              const zonaAccesa = states['binary_sensor.zona_led_camera_accesa']?.state === 'on';
              const last = states['input_text.ultima_zona_led']?.state || '';
              const isSelected = last === 'Luce Camera';
              
              if (!zonaAccesa) return 'script.hw_room_led_on';
              if (zonaAccesa && isSelected) return 'script.hw_room_led_off';
              return 'input_text.set_value';
            ]]]
          service_data: |
            [[[
              const zonaAccesa = states['binary_sensor.zona_led_camera_accesa']?.state === 'on';
              const last = states['input_text.ultima_zona_led']?.state || '';
              const isSelected = last === 'Luce Camera';
              
              if (zonaAccesa && !isSelected) {
                return {
                  entity_id: 'input_text.ultima_zona_led',
                  value: 'Luce Camera'
                };
              }
              return {};
            ]]]
        styles:
          card:
            - background: rgba(255,255,255,0.08)
            - border-radius: 12px
            - border: |
                [[[ return entity.state === 'on'
                    ? '2px solid #90caf9'
                    : '1px solid rgba(255,255,255,0.15)' ]]]
            - box-shadow: |
                [[[
                  const last = states['input_text.ultima_zona_led']?.state || '';
                  const binary = states['binary_sensor.zona_led_camera_accesa']?.state === 'on';
                  const selected = last === 'Luce Camera' || binary;
                  return selected ? '0 0 14px #90caf9' : 'none';
                ]]]
          icon:
            - width: 70px
            - color: |
                [[[
                  const last = states['input_text.ultima_zona_led']?.state || '';
                  const binary = states['binary_sensor.zona_led_camera_accesa']?.state === 'on';
                  const selected = last === 'Luce Camera' || binary;
                  return selected ? '#90caf9' : 'rgba(255,255,255,0.4)';
                ]]]
          name:
            - color: |
                [[[
                  const last = states['input_text.ultima_zona_led']?.state || '';
                  const binary = states['binary_sensor.zona_led_camera_accesa']?.state === 'on';
                  const selected = last === 'Luce Camera' || binary;
                  return selected ? '#90caf9' : 'white';
                ]]]
            - margin-top: 8px
      - type: custom:button-card
        styles:
          card:
            - width: 12px
            - background: transparent
            - border: none
            - box-shadow: none
            - padding: 0
            - cursor: default
        tap_action:
          action: none

  # ============================================================
  # ⭐ SLIDER (visibile quando una luce è selezionata)
  # ============================================================
  - type: conditional
    conditions:
      - entity: binary_sensor.zona_camera_slider_visibile
        state: "on"
    card:
      type: horizontal-stack
      cards:
        - type: custom:button-card
          styles:
            card:
              - width: 12px
              - background: transparent
              - border: none
              - box-shadow: none
              - padding: 0
              - cursor: default
          tap_action:
            action: none
        - type: light
          entity: light.luci
          name: Luci Camera
          card_mod:
            style: |
              ha-card {
                flex: 1 1 100% !important;
                background: rgba(255,255,255,0.08) !important;
                border-radius: 12px !important;
                border: 1px solid rgba(255,255,255,0.15) !important;
              }
        - type: custom:button-card
          styles:
            card:
              - width: 12px
              - background: transparent
              - border: none
              - box-shadow: none
              - padding: 0
              - cursor: default
          tap_action:
            action: none

  # ============================================================
  # ⭐ PRESET (Bassa • Media • Alta) - sotto lo slider
  # ============================================================
  - type: conditional
    conditions:
      - entity: binary_sensor.zona_camera_slider_visibile
        state: "on"
    card:
      type: horizontal-stack
      cards:
        - type: custom:button-card
          styles:
            card:
              - width: 12px
              - background: transparent
              - border: none
              - box-shadow: none
              - padding: 0
              - cursor: default
          tap_action:
            action: none
        # ⭐ BASSA
        - type: custom:button-card
          name: Bassa
          icon: mdi:brightness-3
          tap_action:
            action: call-service
            service: script.hw_room_led_low
          styles:
            card:
              - background: rgba(255,255,255,0.08)
              - border-radius: 12px
              - border: 1px solid rgba(255,255,255,0.15)
            icon:
              - width: 30px
              - color: "#ffb74d"
            name:
              - color: white
              - font-size: 13px
              - margin-top: 6px

        # ⭐ MEDIA
        - type: custom:button-card
          name: Media
          icon: mdi:brightness-5
          tap_action:
            action: call-service
            service: script.hw_room_led_medium
          styles:
            card:
              - background: rgba(255,255,255,0.08)
              - border-radius: 12px
              - border: 1px solid rgba(255,255,255,0.15)
            icon:
              - width: 30px
              - color: "#ffe082"
            name:
              - color: white
              - font-size: 13px
              - margin-top: 6px

        # ⭐ ALTA
        - type: custom:button-card
          name: Alta
          icon: mdi:brightness-7
          tap_action:
            action: call-service
            service: script.hw_room_led_high
          styles:
            card:
              - background: rgba(255,255,255,0.08)
              - border-radius: 12px
              - border: 1px solid rgba(255,255,255,0.15)
            icon:
              - width: 30px
              - color: "#fff59d"
            name:
              - color: white
              - font-size: 13px
              - margin-top: 6px
        - type: custom:button-card
          styles:
            card:
              - width: 12px
              - background: transparent
              - border: none
              - box-shadow: none
              - padding: 0
              - cursor: default
          tap_action:
            action: none
